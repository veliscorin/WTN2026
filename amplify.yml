version: 1
frontend:
  phases:
    preBuild:
      commands:
        - npm ci
        - 'echo "Verifying WTN DynamoDB environment variables..."'
        - 'if [ -z "$DYNAMODB_USER_TABLE" ]; then echo "❌ Error: DYNAMODB_USER_TABLE is not set"; exit 1; else echo "✅ DYNAMODB_USER_TABLE is present"; fi'
        - 'echo "Creating .env.production file..."'
        - 'echo "WTN_AWS_ACCESS_KEY_ID=$WTN_AWS_ACCESS_KEY_ID" >> .env.production'
        - 'echo "WTN_AWS_SECRET_ACCESS_KEY=$WTN_AWS_SECRET_ACCESS_KEY" >> .env.production'
        - 'echo "WTN_AWS_REGION=$WTN_AWS_REGION" >> .env.production'
        - 'echo "DYNAMODB_USER_TABLE=$DYNAMODB_USER_TABLE" >> .env.production'
        - 'echo "DYNAMODB_QUESTIONS_TABLE=$DYNAMODB_QUESTIONS_TABLE" >> .env.production'
        - 'echo "DYNAMODB_SCHOOLS_TABLE=$DYNAMODB_SCHOOLS_TABLE" >> .env.production'
    build:
      commands:
        - npm run build
  artifacts:
    baseDirectory: .next
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*
